
import { defineStore } from "pinia";

export const useVulnerabilityStore = defineStore("vulnerabilityStore", {
  state: () => ({
    vulnerabilities: [],
  }),
  getters: {
    // 按你的后端字段增补，这里给出通用示例
    desription: (state) => ([...new Set(state.vulnerabilities.map(v => v.plugin))].sort()),
    names:   (state) => ([...new Set(state.vulnerabilities.map(v => v.name))].sort()),
  },
  actions: {
    async getVulnerabilities($api, params = {}) {
      try {
        const { data } = await $api.get("/api/v2/vulnerabilities", { params });
        this.vulnerabilities = Array.isArray(data) ? data : (data?.items ?? []);
      } catch (error) {
        console.error("Error fetching vulnerabilities", error);
      }
    },

    async saveVulnerabilities($api, vulnerabilities) {
      const response = await $api.post(`/api/v2/vulnerabilities`, vulnerabilities);
      this.vulnerabilities.push(response.data);
  },

    async deleteVulnerability($api, vulnerabilityName, addPath=false) {

      await $api.delete(`/api/v2/vulnerabilities/by-name/${encodeURIComponent(vulnerabilityName)}`);

    },
  },

});
